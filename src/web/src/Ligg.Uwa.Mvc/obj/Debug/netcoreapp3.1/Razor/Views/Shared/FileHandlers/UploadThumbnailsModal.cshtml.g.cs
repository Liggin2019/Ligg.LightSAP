#pragma checksum "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "2c1c90d3bbffb8bf8dd59167f92948f98c2861be"
// <auto-generated/>
#pragma warning disable 1591
[assembly: global::Microsoft.AspNetCore.Razor.Hosting.RazorCompiledItemAttribute(typeof(AspNetCore.Views_Shared_FileHandlers_UploadThumbnailsModal), @"mvc.1.0.view", @"/Views/Shared/FileHandlers/UploadThumbnailsModal.cshtml")]
namespace AspNetCore
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Mvc;
    using Microsoft.AspNetCore.Mvc.Rendering;
    using Microsoft.AspNetCore.Mvc.ViewFeatures;
#nullable restore
#line 4 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\_ViewImports.cshtml"
using Ligg.Infrastructure.Helpers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\_ViewImports.cshtml"
using Ligg.Infrastructure.Extensions;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\_ViewImports.cshtml"
using Ligg.Infrastructure.Utilities.DataParserUtil;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\_ViewImports.cshtml"
using Ligg.EntityFramework.Entities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\_ViewImports.cshtml"
using Ligg.Uwa.Application;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\_ViewImports.cshtml"
using Ligg.Uwa.Application.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\_ViewImports.cshtml"
using Ligg.Uwa.Basis.SYS;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\_ViewImports.cshtml"
using Ligg.Uwa.Basis.SCC;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\_ViewImports.cshtml"
using Ligg.Uwa.Mvc.Helpers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\_ViewImports.cshtml"
using Ligg.Uwa.Mvc.ViewComponents;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\_ViewImports.cshtml"
using Humanizer;

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"2c1c90d3bbffb8bf8dd59167f92948f98c2861be", @"/Views/Shared/FileHandlers/UploadThumbnailsModal.cshtml")]
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"353fc76568021bcef0b679f35d70c936ed16d2f8", @"/Views/_ViewImports.cshtml")]
    public class Views_Shared_FileHandlers_UploadThumbnailsModal : global::Microsoft.AspNetCore.Mvc.Razor.RazorPage<dynamic>
    {
        #pragma warning disable 1998
        public async override global::System.Threading.Tasks.Task ExecuteAsync()
        {
#nullable restore
#line 1 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
   Layout = "~/Views/Shared/_ModalForm.cshtml"; 

#line default
#line hidden
#nullable disable
            WriteLiteral("\r\n");
            DefineSection("header", async() => {
                WriteLiteral("\r\n    ");
#nullable restore
#line 5 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
Write(BundlerHelper.Render(HostingEnvironment.ContentRootPath, Url.Content("~/lib/cropbox/1.0/cropbox.min.css")));

#line default
#line hidden
#nullable disable
                WriteLiteral("\r\n    ");
#nullable restore
#line 6 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
Write(BundlerHelper.Render(HostingEnvironment.ContentRootPath, Url.Content("~/lib/cropbox/1.0/cropbox.min.js")));

#line default
#line hidden
#nullable disable
                WriteLiteral("\r\n");
            }
            );
            WriteLiteral(@"
<div class=""container"">
    <div class=""imageBox"">
        <div class=""thumbBox""></div>
        <div class=""spinner"" style=""display: none"">Loading...</div>
    </div>
    <div class=""action"">
        <div class=""new-contentarea tc"">
            <a href=""javascript:void(0)"" class=""upload-img""> <label for=""avatar"">选择图片</label> </a>
            <input type=""file"" id=""thumbnail"" accept=""image/*"" />
        </div>
        <input type=""button"" id=""btnUpload"" class=""Btnsty_peyton"" value=""上传"" />
        <input type=""button"" id=""btnZoomIn"" class=""Btnsty_peyton"" value=""+"" />
        <input type=""button"" id=""btnZoomOut"" class=""Btnsty_peyton"" value=""-"" />
        <input type=""button"" id=""btnCrop"" class=""Btnsty_peyton"" value=""效果"" />
    </div>
    <div class=""cropped""></div>
</div>

<script type=""text/javascript"">
    var id = ys.request(""id"");
    var index = '");
#nullable restore
#line 29 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
            Write(ViewBag.Index);

#line default
#line hidden
#nullable disable
            WriteLiteral("\';\r\n    var obj = \'");
#nullable restore
#line 30 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
          Write(ViewBag.Object);

#line default
#line hidden
#nullable disable
            WriteLiteral("\';\r\n    var objId = \'");
#nullable restore
#line 31 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
            Write(ViewBag.ObjectId);

#line default
#line hidden
#nullable disable
            WriteLiteral("\';\r\n    var uploadType = \'");
#nullable restore
#line 32 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
                 Write(ViewBag.UploadType);

#line default
#line hidden
#nullable disable
            WriteLiteral("\';\r\n    var newFileTitle = \'");
#nullable restore
#line 33 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
                   Write(ViewBag.NewFileTitle);

#line default
#line hidden
#nullable disable
            WriteLiteral("\';\r\n\r\n    var initFileName=\'");
#nullable restore
#line 35 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
                 Write(ViewBag.InitFileName);

#line default
#line hidden
#nullable disable
            WriteLiteral("\';\r\n    var mode = \'");
#nullable restore
#line 36 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
           Write(ViewBag.Mode);

#line default
#line hidden
#nullable disable
            WriteLiteral("\';\r\n    var saveDatabaseUrl=\'");
#nullable restore
#line 37 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
                    Write(Html.Raw(ViewBag.SaveDatabaseUrl));

#line default
#line hidden
#nullable disable
            WriteLiteral("\';\r\n    var upLoadStatus = \'\';\r\n\r\n    var cropper;\r\n    var imgFilePath;\r\n\r\n\r\n    $(function () {\r\n        var initThumbnailUrl = \'");
#nullable restore
#line 45 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
                           Write(Url.Content("~/File/GetImage"));

#line default
#line hidden
#nullable disable
            WriteLiteral(@"' + '?index=' + index + '&obj=' + obj + '&objId=' + objId + '&fileName=' + initFileName;
        var options = {
            thumbBox: '.thumbBox',
            spinner: '.spinner',
            imgSrc: initThumbnailUrl
        };

        cropper = $('.imageBox').cropbox(options);
        $('#thumbnail').on('change', function () {
            var file = this.files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                options.imgSrc = e.target.result;
                //根据MIME判断上传的文件是不是图片类型
                if ((options.imgSrc).indexOf(""image/"") == -1) {
                    ys.msgError(""文件格式错误，请上传图片类型,如：JPG,JEPG，PNG后缀的文件。"");
                } else {
                    cropper = $('.imageBox').cropbox(options);
                }
            }
            reader.readAsDataURL(file);
            imgFilePath = file.name;
        });

        $('#btnCrop').on('click', function () {
            if (!checkImageFileName()) {
                re");
            WriteLiteral(@"turn;
            }
            var img = cropper.getDataURL();
            $('.cropped').html('');
            $('.cropped').append('<img src=""' + img + '"" align=""absmiddle"" style=""width:64px;margin-top:4px;border-radius:64px;box-shadow:0px 0px 12px #7E7E7E;"" ><p>64px*64px</p>');
            $('.cropped').append('<img src=""' + img + '"" align=""absmiddle"" style=""width:128px;margin-top:4px;border-radius:128px;box-shadow:0px 0px 12px #7E7E7E;""><p>128px*128px</p>');
            $('.cropped').append('<img src=""' + img + '"" align=""absmiddle"" style=""width:180px;margin-top:4px;border-radius:180px;box-shadow:0px 0px 12px #7E7E7E;""><p>180px*180px</p>');
        });

        $('#btnZoomIn').on('click', function () {
            cropper.zoomIn();
        });

        $('#btnZoomOut').on('click', function () {
            cropper.zoomOut();
        });

        $('#btnUpload').on('click', function () {
            Upload();
            var index = parent.layer.getFrameIndex(window.name);
            if");
            WriteLiteral(@" (mode=='SingleMode') {
                waitUpload("""", index);
            }
            else if (mode == 'SingleMode1'){
                waitUpload1("""", index);
            }
        });


    });

    function Upload() {
        if (!checkImageFileName()) {
            return;
        }
        var img = cropper.getBlob();
        var formdata = new FormData();
        formdata.append(""fileList"", img, imgFilePath);
        ys.ajaxUploadFile({
            url: '");
#nullable restore
#line 110 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
             Write(Url.Content("~/File/Upload"));

#line default
#line hidden
#nullable disable
            WriteLiteral(@"' + '?index=' + index + '&obj=' + obj + '&objId=' + objId + '&newFileTitle=' + newFileTitle + '&uploadType=' + uploadType,
            data: formdata,
            async: false,
            success: function (rst) {
                if (rst.Flag == 1) {
                    SaveDatabase(rst.Data);
                    upLoadStatus = rst.Flag;
                    ys.msgSuccess(rst.Message);
                }
                else {
                    upLoadStatus = rst.Flag;
                    ys.msgError(rst.Message);
                }
            }
        });
    }

    function SaveDatabase(fileName) {
        var saveDatabaseUrl1 = '");
#nullable restore
#line 128 "D:\Doing\coding\coding-doing\arch\Ligg.Web\src-sharing\src\web\src\Ligg.Uwa.Mvc\Views\Shared\FileHandlers\UploadThumbnailsModal.cshtml"
                           Write(Url.Content("~/"));

#line default
#line hidden
#nullable disable
            WriteLiteral(@"'+saveDatabaseUrl + (saveDatabaseUrl.includes('?') ? '&fileName=' + fileName : '?fileName=' + fileName);
        if (saveDatabaseUrl) {
            ys.ajax({
                url: saveDatabaseUrl1,
                type: ""post"",
                success: function (rst) {
                    if (rst.Flag == 1) {
                    }
                    else ys.msgError(rst.Message);
                }
            });
        }
    }

    function waitUpload(flag, index) {
        if (!flag) {
            setTimeout(function () {
                var flag = upLoadStatus != '';
                waitUpload(flag, index);
            }, 1000);
            return;
        }
        parent.searchGrid();
        parent.layer.close(index);
    }

    function waitUpload1(flag, index) {
        if (!flag) {
            setTimeout(function () {
                var flag = upLoadStatus != '';
                waitUpload1(flag, index);
            }, 1000);
            return;
        }
        p");
            WriteLiteral(@"arent.reloadLocation();
        parent.layer.close(index);
    }


    function LeaveAndRefreshParent(index) {
        parent.searchGrid();
        parent.layer.close(index);
    }
    function LeaveForm(index) {
        parent.layer.close(index);
    }


    function checkImageFileName() {
        if (ys.isNullOrEmpty(imgFilePath)) {
            ys.msgError(""请先选择图片"");
            return false;
        }

        else {
            return true;
        }
    }




</script>");
        }
        #pragma warning restore 1998
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public Microsoft.AspNetCore.Hosting.IWebHostEnvironment HostingEnvironment { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.ViewFeatures.IModelExpressionProvider ModelExpressionProvider { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IUrlHelper Url { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IViewComponentHelper Component { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IJsonHelper Json { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IHtmlHelper<dynamic> Html { get; private set; }
    }
}
#pragma warning restore 1591
